<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Kalendář dovolené</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .controls, .admin-panel { margin: 10px 0; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; }
    .day, .weekday { border: 1px solid #ccc; padding: 10px; text-align: center; border-radius: 5px; position: relative; min-height: 60px; }
    .weekday { background-color: #f0f0f0; font-weight: bold; cursor: default; }
    .day { cursor: pointer; background-color: white; }
    .holiday { background-color: #ffdddd !important; }
    .unavailable { background-color: #ddddff !important; }
    .public-holiday:not(.holiday):not(.unavailable) { background-color: #fff7cc !important; }
    .weekend:not(.holiday):not(.unavailable):not(.public-holiday) { background-color: #f0f0f0 !important; }
    .label { font-size: 10px; position: absolute; bottom: 4px; left: 4px; color: #555; }
    .legend { margin-top: 20px; display: flex; gap: 15px; flex-wrap: wrap; }
    .legend-item { display: flex; align-items: center; gap: 5px; }
    .legend-color { width: 20px; height: 20px; border-radius: 3px; border: 1px solid #aaa; }
    .color-holiday { background-color: #ffdddd; }
    .color-unavailable { background-color: #ddddff; }
    .color-public { background-color: #fff7cc; }
    .color-weekend { background-color: #f0f0f0; }
  </style>
</head>
<body>
<h1>Kalendář dovolené</h1>

<div>
  <input type="text" id="username" placeholder="Zadejte své jméno">
  <input type="password" id="password" placeholder="Zadejte heslo">
  <button id="loginButton">Přihlásit</button>
  <button id="logoutButton">Odhlásit</button>
</div>

<div class="controls">
  <label><input type="radio" name="mode" value="holiday" checked> Dovolená</label>
  <label><input type="radio" name="mode" value="unavailable"> Nedostupný</label>
  <label><input type="radio" name="mode" value="none"> Smazat</label>
  <button id="submitButton">Uložit a odeslat požadavek</button>
</div>

<div>
  <button onclick="changeMonth(-1)">« Předchozí</button>
  <span id="monthLabel"></span>
  <button onclick="changeMonth(1)">Další »</button>
</div>

<div class="calendar" id="calendar"></div>

<div class="legend">
  <div class="legend-item"><div class="legend-color color-holiday"></div> Dovolená</div>
  <div class="legend-item"><div class="legend-color color-unavailable"></div> Nedostupný</div>
  <div class="legend-item"><div class="legend-color color-public"></div> Státní svátek</div>
  <div class="legend-item"><div class="legend-color color-weekend"></div> Víkend</div>
</div>

<script>
const userCredentials = {
  "jan.kral": "abc123",
  "kupka": "xyz456"
};

let currentUser = '';
let selectedHoliday = [], selectedUnavailable = [], currentMode = 'holiday';
let currentYear = new Date().getFullYear();
let currentMonth = new Date().getMonth();

window.addEventListener("DOMContentLoaded", () => {
  const loginButtonEl = document.getElementById("loginButton");
  const submitButtonEl = document.getElementById("submitButton");

  if (loginButtonEl) loginButtonEl.addEventListener("click", login);
  const logoutButtonEl = document.getElementById("logoutButton");
  if (logoutButtonEl) logoutButtonEl.addEventListener("click", logout);
  if (submitButtonEl) submitButtonEl.addEventListener("click", saveAndRequest);

  document.querySelectorAll('input[name="mode"]').forEach(el => {
    el.addEventListener('change', () => currentMode = el.value);
  });

  const lastUser = localStorage.getItem('lastUser');
  if (lastUser) {
    const usernameInput = document.getElementById("username");
    if (usernameInput) {
      usernameInput.value = lastUser;
      currentUser = lastUser;
      loadUserData();
    }
  }
});

function login() {
  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");
  const name = usernameInput.value.trim();
  const password = passwordInput.value.trim();

  if (!name || !password) {
    alert("Zadej své jméno i heslo.");
    return;
  }
  if (!(name in userCredentials)) {
    alert("Neexistující uživatel.");
    return;
  }
  if (userCredentials[name] !== password) {
    alert("Špatné heslo.");
    return;
  }

  currentUser = name;
  localStorage.setItem('lastUser', currentUser);
  loadUserData();
}

function logout() {
  alert("Byl jsi odhlášen.");
  currentUser = '';
  localStorage.removeItem('lastUser');
  document.getElementById("username").value = '';
  document.getElementById("password").value = '';
  document.getElementById("calendar").innerHTML = '';
  document.getElementById("monthLabel").textContent = '';
  document.getElementById("username").focus();
  document.querySelector('input[name="mode"][value="holiday"]').checked = true;
  currentMode = 'holiday';
  selectedHoliday = [];
  selectedUnavailable = [];
}

function saveAndRequest() {
  if (!currentUser) {
    alert("Nejprve se přihlas.");
    return;
  }
  const body = `Dovolené: ${selectedHoliday.join(', ')}\nNedostupné: ${selectedUnavailable.join(', ')}`;
  const subject = `${currentUser} – požadavek – ${new Date().toLocaleString('cs-CZ')}`;
  const mailto = `mailto:jan.kupka@pcr.cz?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  alert("Data byla uložena. Bude vygenerován e-mail.");
  window.location.href = mailto;
}
</script>
</body>
</html>
